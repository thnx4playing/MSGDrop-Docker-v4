<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="format-detection" content="telephone=no"/>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<title>Bug Fix Status</title>

<script>
(function(){
  try {
    var saved = sessionStorage.getItem('theme');
    var theme = saved || 'dark';
    document.documentElement.setAttribute('data-theme', theme);
  } catch(e){}
})();
</script>

<link rel="stylesheet" href="/msgdrop/css/styles.css?v=20260219">
<link rel="stylesheet" href="/msgdrop/css/message-actions-modal.css?v=20260219">
<link rel="stylesheet" href="/msgdrop/css/rich-links.css?v=20260219">
<link rel="stylesheet" href="/msgdrop/css/call-system-messages.css?v=20260219">
</head>
<body>
<div id="appRoot" aria-live="polite">
  <div class="card">
    
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <div class="presence-indicators">
          <div id="presenceE" class="presence-badge" data-role="E">
            <span class="presence-dot"></span>
            <span class="presence-label">E</span>
          </div>
          <div id="presenceM" class="presence-badge" data-role="M">
            <span class="presence-dot"></span>
            <span class="presence-label">M</span>
          </div>
        </div>
        <div id="streakDisplay" class="streak-display">
          <span class="streak-flame">üî•</span>
          <span id="streakCount" class="streak-count">0</span>
        </div>
      </div>
      <div class="header-center">
      </div>
      <div class="header-right">
        <!-- FaceTime-style video call button -->
        <button id="videoCallBtn" class="header-call-btn" type="button" aria-label="Video call" title="Start video call">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="23 7 16 12 23 17 23 7"/>
            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
          </svg>
        </button>
        <button id="themeToggle" class="themeBtn" type="button" aria-label="Toggle theme" title="Toggle theme">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M12 4.5V3m5.657 3.343L18.72 5.406M19.5 12H21m-3.343 5.657l1.937 1.937M12 21v-1.5M5.343 18.657 3.406 20.594M3 12h1.5M5.343 5.343 3.406 3.406" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="4.2" fill="none" stroke="currentColor" stroke-width="1.8"/>
          </svg>
        </button>
        <div id="liveStatus" class="connection-indicator" title="Connection status"></div>
      </div>
    </div>

    <!-- Chat Messages -->
    <div id="chatContainer" class="chat-container">
      <div id="typingIndicator" class="typing-indicator-wrapper">
        <div class="typing-bubble">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
    </div>

    <!-- Compose Area -->
    <div id="composeSection" class="compose-section">
      
      <!-- Reply Preview -->
      <div id="replyPreview" class="reply-preview">
        <div class="reply-preview-content">
          <div class="reply-preview-label">
            <svg viewBox="0 0 24 24" width="12" height="12"><path fill="currentColor" d="M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"/></svg>
            Replying to <span id="replyPreviewUser" class="reply-preview-user">E</span>
          </div>
          <div id="replyPreviewText" class="reply-preview-text">Message preview...</div>
        </div>
        <button id="cancelReplyBtn" class="cancel-reply-btn" type="button" aria-label="Cancel reply">
          <svg viewBox="0 0 24 24" width="12" height="12">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      
      <div id="editHeader" class="edit-header">
        <span class="edit-header-text">Editing message</span>
        <button id="cancelEditBtn" class="cancel-edit-btn" type="button">Cancel</button>
      </div>
      
      <div class="compose-row">
        <textarea id="reply" class="compose-textarea" placeholder="Message" rows="1"></textarea>
        <div id="composeTimer" class="compose-timer">298</div>
        <button id="postBtn" class="send-btn" type="button" aria-label="Send" title="Send">
          <img alt="" src="/msgdrop/images/reply.png?v=1">
        </button>
      </div>
      
      <div class="toolbar">
        <button id="userBtn" class="tool-btn" type="button" aria-label="Select Role" title="Select Role">
          <img alt="" src="/msgdrop/images/user.png?v=1">
        </button>	  
        <button id="emojiBtn" class="tool-btn" type="button" aria-label="Emoji" title="Emoji">
          <img alt="" src="/msgdrop/images/emoji.png?v=1">
        </button>
        <button id="uploadBtn" class="tool-btn" type="button" aria-label="Upload Image" title="Upload Image">
          <img alt="" src="/msgdrop/images/upload.png?v=1">
        </button>
        <button id="libraryBtn" class="tool-btn" type="button" aria-label="Image Library" title="Image Library">
          <img alt="" src="/msgdrop/images/attachments.png?v=1">
          <span id="imageCountBadge" class="image-count-badge"></span>
        </button>
        <button id="gamesBtn" class="tool-btn" type="button" aria-label="Games" title="Play Tic-Tac-Toe">
          <img alt="" src="/msgdrop/images/games.png?v=1">
          <span id="activeGamesBadge" class="active-games-badge" style="display: none;"></span>
        </button>
        <button id="gif-button" class="tool-btn" type="button" aria-label="Send GIF" title="Send GIF">
          <img alt="" src="/msgdrop/images/giphy.png?v=1">
        </button>
        <button id="cameraBtn" class="tool-btn" type="button" aria-label="Cage Cam" title="Cage Cam">
          <img alt="" src="/msgdrop/images/webcam.png?v=1">
        </button>
        <!-- Microphone / voice message button -->
        <button id="micBtn" class="tool-btn mic-btn" type="button" aria-label="Record voice message" title="Hold to record voice message">
          <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            <line x1="12" y1="19" x2="12" y2="23"/>
            <line x1="8" y1="23" x2="16" y2="23"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Tic-Tac-Toe Game Modal (unchanged) -->
    <div id="gameModal" class="game-modal">
      <div class="game-panel">
        <button id="gameCloseBtn" class="modal-close-badge" type="button" aria-label="Close">&times;</button>
        <div id="gameStatus" class="game-status">Loading...</div>
        <div id="gameBoard" class="game-board">
          <button class="game-cell" data-row="0" data-col="0" type="button"></button>
          <button class="game-cell" data-row="0" data-col="1" type="button"></button>
          <button class="game-cell" data-row="0" data-col="2" type="button"></button>
          <button class="game-cell" data-row="1" data-col="0" type="button"></button>
          <button class="game-cell" data-row="1" data-col="1" type="button"></button>
          <button class="game-cell" data-row="1" data-col="2" type="button"></button>
          <button class="game-cell" data-row="2" data-col="0" type="button"></button>
          <button class="game-cell" data-row="2" data-col="1" type="button"></button>
          <button class="game-cell" data-row="2" data-col="2" type="button"></button>
        </div>
        <div class="game-actions">
          <button id="gameEndBtn" class="game-btn secondary" type="button">End Game</button>
          <button id="gameCloseBtn2" class="game-btn" type="button">Close</button>
        </div>
      </div>
    </div>

    <!-- Thumbnails Section -->
    <div id="thumbSection" class="thumb-section">
      <button id="thumbCloseBtn" class="modal-close-badge" type="button" aria-label="Close">&times;</button>
      <div id="thumbStrip" class="thumb-container" aria-label="Images">
        <div id="thumbEmpty" class="thumb-empty-state">
          <span style="font-size:48px;opacity:0.3">üì∑</span>
          <span>No images yet</span>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Thumbnail overlay backdrop -->
<div id="thumbOverlay" class="thumb-overlay"></div>

<!-- User Role Selector Modal -->
<div id="userRoleModal" class="user-role-modal">
  <div class="user-role-panel">
    <h3>Who are you?</h3>
    <p>Select your role to personalize the chat</p>
    <div class="user-role-options">
      <button id="roleE" class="user-role-option" type="button" data-role="E">
        <div class="emoji">üëß</div>
      </button>
      <button id="roleM" class="user-role-option" type="button" data-role="M">
        <div class="emoji">üë¶</div>
      </button>
    </div>
  </div>
</div>

<!-- Games Menu Popover -->
<div id="gamesPopover" class="games-popover">
  <div class="games-popover-header">
    <h3 class="games-section-title">Start New Game</h3>
    <button id="gamesPopoverClose" class="modal-close-badge-inline" type="button" aria-label="Close">&times;</button>
  </div>
  <div class="games-list" id="gamesList">
    <button type="button" class="game-item" id="ticTacToeBtn">
      <span class="game-item-icon">‚≠ï</span>
      <span class="game-item-name">Tic-Tac-Toe</span>
    </button>
  </div>
  <h3 class="games-section-title" id="activeGamesTitle" style="display:none;">Active Games</h3>
  <div class="games-list" id="activeGamesList"></div>
</div>

<!-- Reaction Picker -->
<div id="reactPicker" class="react-picker">
  <div class="react-picker-grid"></div>
</div>

<!-- Emoji Popover -->
<div id="emojiPopover" class="emoji-popover">
  <div id="emojiGrid" class="emoji-grid"></div>
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" role="dialog" aria-modal="true">
  <img id="lightboxImg" alt="" />
  <button id="lbCloseCenter" class="lightbox-close" aria-label="Close">
    <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
      <path d="M6 6 L18 18 M18 6 L6 18" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </button>
  <div id="lbLoading" class="lightbox-loading" aria-live="polite">
    <div class="spinner" role="status" aria-label="Loading"></div>
  </div>
</div>

<!-- Camera Modal -->
<div id="cameraModal" class="camera-modal">
  <div class="camera-container">
    <button id="cameraCloseBtn" class="modal-close-badge" type="button" aria-label="Close">&times;</button>
    <div class="camera-header">
      <span class="camera-title">üêæ Cage Cam</span>
    </div>
    <div class="camera-body">
      <img id="cameraStream" src="" alt="Camera Stream">
      <div id="cameraLoading" class="camera-loading">
        <div class="spinner"></div>
      </div>
    </div>
  </div>
</div>

<!-- ============================================================
     AUDIO RECORDING OVERLAY
     Shows while user holds the mic button
     ============================================================ -->
<div id="audioRecordingOverlay" class="audio-recording-overlay">
  <div class="audio-recording-panel">
    <div class="recording-pulse-ring"></div>
    <div class="recording-mic-icon">
      <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
        <line x1="12" y1="19" x2="12" y2="23"/>
        <line x1="8" y1="23" x2="16" y2="23"/>
      </svg>
    </div>
    <div id="recordingWaveform" class="recording-waveform">
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
      <span class="wave-bar"></span>
    </div>
    <div class="recording-info">
      <span id="recordingTimerDisplay" class="recording-timer">1:00</span>
      <span class="recording-hint">Release to send ¬∑ Slide up to cancel</span>
    </div>
  </div>
</div>

<!-- ============================================================
     VIDEO CHAT OVERLAY (FaceTime-style)
     ============================================================ -->
<div id="videoChatOverlay" class="vc-overlay">
  <!-- Remote video fills background -->
  <video id="remoteVideo" class="vc-remote-video" autoplay playsinline></video>
  
  <!-- Status text (Calling... / Connecting...) -->
  <div id="videoChatStatus" class="vc-status" style="display:none;"></div>
  
  <!-- Local (self) video - small PiP in corner -->
  <div class="vc-local-wrapper" id="localVideoWrapper">
    <video id="localVideo" class="vc-local-video" autoplay playsinline muted></video>
  </div>

  <!-- Call controls bar at bottom -->
  <div class="vc-controls">
    <button id="videoMuteBtn" class="vc-btn" type="button" aria-label="Mute">
      <span class="vc-icon">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
          <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
          <line x1="12" y1="19" x2="12" y2="23"/>
          <line x1="8" y1="23" x2="16" y2="23"/>
        </svg>
      </span>
      <span class="vc-btn-label">Mute</span>
    </button>

    <button id="videoEndBtn" class="vc-btn vc-end-btn" type="button" aria-label="End call">
      <span class="vc-icon">
        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
          <path d="M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.3-.3.7-.4 1-.2 1.1.4 2.3.6 3.6.6.6 0 1 .4 1 1V20c0 .6-.4 1-1 1-9.4 0-17-7.6-17-17 0-.6.4-1 1-1h3.5c.6 0 1 .4 1 1 0 1.3.2 2.5.6 3.6.1.3 0 .7-.2 1L6.6 10.8z"/>
        </svg>
      </span>
      <span class="vc-btn-label">End</span>
    </button>

    <button id="videoFlipBtn" class="vc-btn" type="button" aria-label="Flip camera">
      <span class="vc-icon">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="1 4 1 10 7 10"/>
          <polyline points="23 20 23 14 17 14"/>
          <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4-4.64 4.36A9 9 0 0 1 3.51 15"/>
        </svg>
      </span>
      <span class="vc-btn-label">Flip</span>
    </button>
  </div>
</div>

<!-- ============================================================
     INCOMING CALL BANNER (FaceTime-style)
     ============================================================ -->
<div id="incomingCallBanner" class="incoming-call-banner">
  <div class="incoming-call-content">
    <div class="incoming-call-avatar">
      <span class="incoming-call-emoji">üì±</span>
    </div>
    <div class="incoming-call-info">
      <div class="incoming-caller-name">E</div>
      <div class="incoming-call-label">MSGDrop ¬∑ Video</div>
    </div>
  </div>
  <div class="incoming-call-actions">
    <button id="incomingDeclineBtn" class="incoming-btn incoming-decline" type="button" aria-label="Decline">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
        <path d="M6.6 10.8c1.4 2.8 3.8 5.1 6.6 6.6l2.2-2.2c.3-.3.7-.4 1-.2 1.1.4 2.3.6 3.6.6.6 0 1 .4 1 1V20c0 .6-.4 1-1 1-9.4 0-17-7.6-17-17 0-.6.4-1 1-1h3.5c.6 0 1 .4 1 1 0 1.3.2 2.5.6 3.6.1.3 0 .7-.2 1L6.6 10.8z"/>
      </svg>
      <span>Decline</span>
    </button>
    <button id="incomingAcceptBtn" class="incoming-btn incoming-accept" type="button" aria-label="Accept">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="23 7 16 12 23 17 23 7"/>
        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
      </svg>
      <span>Accept</span>
    </button>
  </div>
</div>

<!-- Hidden file input -->
<input id="fileInput" type="file" accept="image/*"/>

<!-- Scripts -->
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script src="/msgdrop/js/config.js?v=20260219"></script>
<script src="/msgdrop/js/storage.js?v=20260219"></script>
<script src="/msgdrop/js/cookie-checker.js?v=20260219"></script>
<script src="/msgdrop/js/api.js?v=20260219"></script>
<script src="/msgdrop/js/websocket.js?v=20260219"></script>
<script src="/msgdrop/js/ui.js?v=20260219"></script>
<script src="/msgdrop/js/rich-links.js?v=20260219"></script>
<script src="/msgdrop/js/messages.js?v=20260219"></script>
<script src="/msgdrop/js/reactions.js?v=20260219"></script>
<script src="/msgdrop/js/images.js?v=20260219"></script>
<script src="/msgdrop/js/streak.js?v=20260219"></script>
<script src="/msgdrop/js/game.js?v=20260219"></script>
<script src="/msgdrop/js/giphy.js?v=20260219"></script>
<script src="/msgdrop/js/camera.js?v=20260219"></script>
<script src="/msgdrop/js/audio.js?v=20260219"></script>
<script src="/msgdrop/js/videochat.js?v=20260219"></script>
<script src="/msgdrop/js/app.js?v=20260219"></script>
</body>
</html>
